<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Model Catalog — Arabic ITSM</title>
  <link rel="stylesheet" href="/static/common.css">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    .meta { color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1.5rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
    .model-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .model-card:hover { border-color: var(--text-muted); box-shadow: var(--shadow-md); }
    .model-card-head { display: flex; justify-content: space-between; align-items: flex-start; gap: 0.5rem; }
    .model-title { font-weight: 600; font-size: 1rem; }
    .model-id { color: var(--text-muted); font-size: 0.75rem; font-family: ui-monospace, monospace; }
    .model-path { color: var(--text-muted); font-size: 0.75rem; word-break: break-all; line-height: 1.4; }
    .model-card .btn { margin-top: auto; }
    .empty-card {
      background: var(--surface);
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      padding: 2rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9375rem;
    }
    .nav-link { display: inline-flex; align-items: center; gap: 0.35rem; }
  </style>
</head>
<body>
  <div class="page-wide" style="padding-top: 2rem;">
    <header class="header">
      <div class="header-brand">
        <h1>Model Catalog</h1>
        <p><strong>Classifier</strong> uses the default model. <strong>Compare</strong> runs across all models. Set <code>DEFAULT_MODEL_ID</code> in .env to change the default.</p>
      </div>
      <div class="header-actions">
        <a class="btn nav-link" href="/classify">
          <i data-lucide="sparkles" style="width:16px;height:16px;"></i>
          Classifier
        </a>
        <a class="btn nav-link" href="/compare">Compare</a>
        <button class="btn-icon" id="themeBtn" type="button" aria-label="Toggle theme">
          <i data-lucide="moon" class="icon-dark" style="width:18px;height:18px;"></i>
          <i data-lucide="sun" class="icon-light hidden" style="width:18px;height:18px;"></i>
        </button>
      </div>
    </header>

    <p class="meta" id="meta">Loading models...</p>
    <div class="grid" id="cards"></div>
  </div>

  <script>
    (function() {
      const root = document.documentElement;
      const saved = localStorage.getItem('theme') || 'light';
      root.setAttribute('data-theme', saved);
    })();

    document.getElementById('themeBtn').addEventListener('click', () => {
      const root = document.documentElement;
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      document.querySelector('.icon-dark').classList.toggle('hidden', next === 'dark');
      document.querySelector('.icon-light').classList.toggle('hidden', next === 'light');
      lucide.createIcons();
    });

    lucide.createIcons();

    function warmBadge(model) {
      if (model.status === 'ready' || model.loaded) {
        return '<span class="badge badge-success"><i data-lucide="check-circle" style="width:12px;height:12px;vertical-align:-2px;"></i> Ready</span>';
      }
      if (model.status === 'loading') {
        return `<span class="badge badge-warning">Loading ${model.progress || 0}%</span>`;
      }
      return '<span class="badge" style="background:var(--info-bg);color:var(--info-text);border:none;"><i data-lucide="circle" style="width:12px;height:12px;vertical-align:-2px;"></i> Cold</span>';
    }

    async function loadModels() {
      const res = await fetch('/api/models');
      const data = await res.json();
      const cards = document.getElementById('cards');
      const meta = document.getElementById('meta');
      const models = data.models || [];

      if (!models.length) {
        meta.textContent = 'No model profiles found.';
        cards.innerHTML = '<div class="empty-card">No checkpoints discovered. Set MODEL_DIRS in .env (semicolon separated directories).</div>';
        return;
      }

      meta.textContent = `${models.length} model(s) · Default: ${data.default_model_id || '-'}`;
      cards.innerHTML = models.map(m => `
        <article class="model-card">
          <div class="model-card-head">
            <span class="model-title">${m.name}</span>
            ${warmBadge(m)}
          </div>
          <div class="model-id">${m.id}</div>
          <div class="model-path">${m.path}</div>
          <div class="progress-bar"><div class="progress-fill" style="width:${m.progress || 0}%"></div></div>
          <a class="btn btn-primary" href="/models/${encodeURIComponent(m.id)}">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
            Open Model
          </a>
        </article>
      `).join('');

      lucide.createIcons();
    }

    loadModels().catch(err => {
      document.getElementById('meta').textContent = `Failed to load: ${err.message}`;
    });

    document.querySelector('.icon-dark').classList.toggle('hidden', document.documentElement.getAttribute('data-theme') === 'dark');
    document.querySelector('.icon-light').classList.toggle('hidden', document.documentElement.getAttribute('data-theme') === 'light');
  </script>
</body>
</html>
